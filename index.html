<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memecoins Hotlist</title>
    <link rel="stylesheet" href="styles/style.css">
    <style>
    </style>
</head>
<body>

    <div class="header-layout">
        <div class="left-gap"></div>
        <div class="logo-container">
            <img id="logo" src="assets/images/logo.png" alt="MemeOnly Logo"> 
            <div id="site-name">MemeOnly</div>
        </div>
        <div class="right-gap"></div>
    </div>

    <header>
        <div id="hotlist">
            <div id="top-list-wrapper">
                <ul id="top-list">
                </ul>
            </div>
        </div>
    </header>

    <nav>
        <div class="nav-left">
            <a href="index.html">Home</a>
            <a href="pages/nft.html">NFT's</a>
            <a href="pages/gainers-losers.html">Gewinner und Verlierer</a>
        </div>
        <div class="nav-right">
            <a href="pages/portfolio.html" onclick="accessRestrictedPage('portfolio')">Portfolio</a>
            <a href="#" onclick="accessRestrictedPage('watchlist')">Watchlist</a>
            <input type="text" placeholder="Suche nach Coins oder NFTs" id="search-bar">
            <button id="login-button" onclick="showLoginModal()">Log in / Registrieren</button>
            <button id="logout-button" class="hidden" onclick="logout()">Abmelden</button>
        </div>
    </nav>

    <div class="table-layout">
        <div class="left-gap"></div>
        <div class="main-table-container">
            <main>
                <section id="top-memecoins">
                    <h3>Memecoins</h3>
                    <div id="memecoins-container">
                        <table id="memecoins-table">
                            <thead>
                                <tr>
                                    <th onclick="sortTable(0)">#</th>
                                    <th onclick="sortTable(1)">Kryptowährung</th>
                                    <th onclick="sortTable(2)">Kurs</th>
                                    <th onclick="sortTable(3)">1h %</th>
                                    <th onclick="sortTable(4)">24h %</th>
                                    <th onclick="sortTable(5)">7d %</th>
                                    <th onclick="sortTable(6)">24-Stunden-Volumen</th>
                                    <th onclick="sortTable(7)">Marktkapitalisierung</th>
                                </tr>
                            </thead>
                            <tbody id="memecoins-list">
                                <!-- Dynamische Inhalte der Tabelle -->
                            </tbody>
                        </table>
                    </div>
                </section>
                <div id="pagination"></div>

                <!-- Login/Signup Modal -->
                <div id="modal-background" class="modal-background" onclick="closeModal()"></div>
                <div id="login-signup-modal" class="modal">
                    <div class="tab-container">
                        <div id="tab-login" class="tab active" onclick="showLoginTab()">Log In</div>
                        <div id="tab-signup" class="tab" onclick="showSignupTab()">Sign Up</div>
                    </div>
                    <div id="login-form" class="form-section">
                        <h2>Log in</h2>
                        <form onsubmit="login(); return false;">
                            <label>Nutzername</label>
                            <input type="text" id="login-username" placeholder="Nutzername" required>
                            <label>Passwort</label>
                            <input type="password" id="login-password" placeholder="Passwort" required>
                            <button type="submit" class="btn-primary">Log In</button>
                        </form>
                    </div>
                    <div id="signup-form" class="form-section" style="display: none;">
                        <h2>Sign Up</h2>
                        <form onsubmit="register(); return false;">
                            <label>Nutzername</label>
                            <input type="text" id="username" placeholder="Nutzername" required>
                            <label>Passwort</label>
                            <input type="password" id="password" placeholder="Passwort" required>
                            <p style="font-size: 0.9em; color: red;">Hinweis: Wenn Sie Ihr Passwort vergessen, gibt es keine Möglichkeit, es wiederherzustellen.</p>
                            <button type="submit" class="btn-primary">Registrieren</button>
                        </form>
                    </div>
                </div>
            </main>
        </div>
        <div class="right-gap"></div>
    </div>

    <!-- Suchfunktion für die Coins -->
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const searchBar = document.getElementById("search-bar");

            searchBar.addEventListener("keyup", async function(event) {
                const query = searchBar.value.trim().toLowerCase();
                if (query.length > 2) {
                    const searchResults = await searchCoins(query);
                    displaySearchResults(searchResults);
                } else {
                    clearSearchResults();
                }
            });

            async function searchCoins(query) {
                const response = await fetch("https://api.coingecko.com/api/v3/coins/list");
                const coins = await response.json();
                return coins.filter(coin => coin.name.toLowerCase().includes(query) || coin.symbol.toLowerCase().includes(query));
            }

            function displaySearchResults(results) {
                clearSearchResults();
                const resultsContainer = document.createElement("div");
                resultsContainer.id = "search-results";
                resultsContainer.style.position = "absolute";
                resultsContainer.style.backgroundColor = "#ffffff";
                resultsContainer.style.color = "#000";
                resultsContainer.style.border = "1px solid #ccc";
                resultsContainer.style.width = "200px";
                resultsContainer.style.zIndex = "1000";
                resultsContainer.style.maxHeight = "200px";
                resultsContainer.style.overflowY = "auto";

                results.forEach(coin => {
                    const resultItem = document.createElement("div");
                    resultItem.textContent = `${coin.name} (${coin.symbol.toUpperCase()})`;
                    resultItem.style.padding = "5px";
                    resultItem.style.cursor = "pointer";

                    resultItem.addEventListener("click", function() {
                        window.location.href = `coin-detail.html?coinId=${coin.id}`;
                    });

                    resultsContainer.appendChild(resultItem);
                });

                searchBar.parentElement.appendChild(resultsContainer);
            }

            function clearSearchResults() {
                const existingResults = document.getElementById("search-results");
                if (existingResults) {
                    existingResults.remove();
                }
            }

            document.addEventListener("click", function(event) {
                if (!searchBar.contains(event.target)) {
                    clearSearchResults();
                }
            });
        });

        let sortDirection = {}; 
        let originalRows = []; 

        document.addEventListener("DOMContentLoaded", function() {
            const tableBody = document.getElementById("memecoins-list");
            originalRows = Array.from(tableBody.rows);
        });

        function sortTable(columnIndex) {
            const tableBody = document.getElementById("memecoins-list");
            const rows = Array.from(tableBody.rows);

            if (!sortDirection[columnIndex]) {
                sortDirection[columnIndex] = "asc";
            } else if (sortDirection[columnIndex] === "asc") {
                sortDirection[columnIndex] = "desc";
            } else {
                resetTable();
                sortDirection[columnIndex] = null;
                return;
            }

            rows.sort((rowA, rowB) => {
                const cellA = rowA.cells[columnIndex].innerText.trim();
                const cellB = rowB.cells[columnIndex].innerText.trim();
                const a = isNaN(cellA) ? cellA : parseFloat(cellA.replace(/[^0-9.-]+/g, ""));
                const b = isNaN(cellB) ? cellB : parseFloat(cellB.replace(/[^0-9.-]+/g, ""));

                if (sortDirection[columnIndex] === "asc") {
                    return a > b ? 1 : -1;
                } else {
                    return a < b ? 1 : -1;
                }
            });

            tableBody.innerHTML = "";
            rows.forEach(row => tableBody.appendChild(row));
        }

        function resetTable() {
            const tableBody = document.getElementById("memecoins-list");
            tableBody.innerHTML = "";
            originalRows.forEach(row => tableBody.appendChild(row));
        }
    </script>
    <script src="scripts/main.js"></script>
    <script src="scripts/hotlist.js"></script>
</body>
</html>
